## 保存位置与文件名
- 目标路径：/home/ubuntu/codes/cineMind/docs/接口规范-前后端通信模块.md
- 格式：Markdown（.md），UTF-8，采用二级标题组织章节。

## 文档内容（将按下列结构写入 .md）
### 接口总览
- 基于 public/config.json 的端点与超时配置，封装 HTTP 与 WebSocket 通信。
- “生成任务”接口请求体采用中文键名的键值对（key:value）形式。
- 使用原生 fetch + AbortController 实现超时与拦截，WebSocket 提供任务状态订阅。

### 配置与默认值
- 配置来源：[config.json](file:///home/ubuntu/codes/cineMind/fronted/public/config.json)；加载： [configService.ts](file:///home/ubuntu/codes/cineMind/fronted/services/configService.ts)
- 字段与默认值：frontendPort=3001、backendHost=localhost、backendPort=3000、timeout=30000、endpoints.generate=/generate、endpoints.nodes=/nodes
- 基础 URL：protocol + backendHost + ":" + backendPort；开发 http/ws，生产 https/wss。

### HTTP 通信规范
- httpClient（fetch 封装）：baseURL、超时（AbortController）、请求/响应拦截、标准化异常 HttpError
- 响应包：成功 { success: true, data }；失败 { success: false, error: { code, message, details? } }

### 生成任务接口（POST ${endpoints.generate}）—键值对请求体
- URL：`${protocol}://${backendHost}:${backendPort}${endpoints.generate}`
- 必填键：任务ID（UUIDv4）、影片类型、环境背景、图像比例、分辨率；可扩展键如光照风格、镜头语言等。
- 示例请求：
```json
{
  "任务ID": "a6c7b8f4-9c21-4f13-8d3c-ef57e1c2c9ab",
  "影片类型": "科幻",
  "环境背景": "城市夜景",
  "图像比例": "16:9",
  "分辨率": "1024x576",
  "光照风格": "冷光",
  "镜头语言": "远景"
}
```
- 成功响应（202 Accepted）：含 taskId、accepted、queuedAt；失败响应含 error.code 与 message。
- 校验：UUIDv4、比例 "W:H"、分辨率 "WxH"、非空字符串。

### 任务状态订阅（WebSocket）
- 端点：`ws(s)://${backendHost}:${backendPort}/ws/tasks`
- 订阅：发送 `{ action: "subscribe", taskId }` 或 `?taskId=...`
- 消息：queued/running/completed/failed/heartbeat；保活 30s，2×timeout 未心跳则重连与重订阅。

### 分页查询（GET ${endpoints.nodes}）—Top 20 规则
- 每次查询固定返回 Top 20 张图，按生成时间倒序（createdAt DESC）。
- URL：`${protocol}://${backendHost}:${backendPort}${endpoints.nodes}?page={page}`（size 不作为请求参数，约定为 20）
- 响应示例含 page、size=20、total、items[]，并断言 createdAt 倒序。

### 大图获取（GET ${endpoints.nodes}/{id}）
- 响应：图片二进制流或 JSON { imageUrl }；前端以 blob 展示；超过 `${timeout}` 取消。

### 错误与重试
- 4xx 直接提示；5xx 指数退避（≤3 次）；网络/超时统一提示；抛出 HttpError。

### 安全与加密
- 生产 HTTPS/WSS；不持久化敏感数据；可选请求签名（X-Signature、X-Timestamp）。

### TypeScript 类型定义
- ApiConfig、GenerateRequestKV（中文键名 + 可扩展键）、GenerateAccepted、TaskEvent、NodeItem、PageResult（size 固定 20）、ApiResponse。

### 测试方案
- Vitest + msw + @testing-library/dom；覆盖配置读取、生成任务键值对校验与超时、WebSocket 状态机与重连、分页 Top 20 排序断言、大图 blob 与性能。

## 后续动作
- 获得确认后：创建 docs/接口规范-前后端通信模块.md 并写入以上 Markdown 内容；随后实现 httpClient、API 模块与测试。